<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PetPetDoc | å…¨æ¸¯ç¸é†«åå–®</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans HK', sans-serif; background-color: #F8FAFC; -webkit-tap-highlight-color: transparent; }
        .clinic-card { transition: all 0.2s; border: 1px solid #e2e8f0; }
        .filter-active { background-color: #f97316 !important; color: white !important; }
        
        /* Quick Map Modal */
        #quickMapModal {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70vh;
            background: white;
            z-index: 3000;
            border-radius: 30px 30px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }
        #quickMapCanvas { height: 100%; width: 100%; border-radius: 30px 30px 0 0; }
        
        @keyframes slideIn { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24">

    <header class="sticky top-0 z-[1000] bg-white/95 backdrop-blur-md shadow-sm border-b border-gray-100">
        <div class="p-4 flex items-center gap-3">
            <button onclick="toggleSidebar()" class="text-xl text-gray-400">â˜°</button>
            
            <div onclick="goHome()" class="flex items-center gap-1 cursor-pointer active:opacity-60 transition-opacity">
                <span class="text-2xl">ğŸ¾</span>
                <span class="text-xl font-bold text-orange-500 tracking-tight">PetPetDoc</span>
            </div>
            
            <div class="relative flex-1 ml-2">
                <input type="text" id="mainSearch" onkeyup="filterClinics()" placeholder="æœå°‹..." 
                    class="w-full bg-gray-100 p-2.5 pl-9 rounded-xl text-sm outline-none focus:ring-2 ring-orange-100 transition-all">
                <span class="absolute left-3 top-2.5 text-gray-400 text-xs">ğŸ”</span>
            </div>
        </div>

        <div class="px-4 pb-3 flex gap-2 overflow-x-auto no-scrollbar">
            <select id="areaFilter" onchange="filterClinics()" class="bg-gray-100 px-3 py-2 rounded-xl text-[11px] font-bold outline-none border-none">
                <option value="">å…¨æ¸¯åœ°å€</option>
                <option value="æ¸¯å³¶">æ¸¯å³¶å€</option>
                <option value="ä¹é¾">ä¹é¾å€</option>
                <option value="æ–°ç•Œ">æ–°ç•Œå€</option>
            </select>
            <button id="btn24hr" onclick="toggleFilter('24hr')" class="bg-gray-100 px-4 py-2 rounded-xl text-[11px] font-bold whitespace-nowrap text-gray-500">ğŸ•’ 24å°æ™‚</button>
            <button id="btnER" onclick="toggleFilter('ER')" class="bg-gray-100 px-4 py-2 rounded-xl text-[11px] font-bold whitespace-nowrap text-gray-500">ğŸš¨ æ€¥ç—‡</button>
        </div>
    </header>

    <main class="p-4" id="listView">
        <div id="resultsCount" class="text-[10px] text-gray-400 font-bold mb-4 px-1">æ­£åœ¨åŒæ­¥æ•¸æ“š...</div>
        <div id="clinicContainer" class="space-y-4">
            </div>
    </main>

    <div id="modalOverlay" class="fixed inset-0 bg-black/40 hidden z-[2999]" onclick="closeQuickMap()"></div>
    <div id="quickMapModal">
        <div class="absolute top-4 right-4 z-[3001]">
            <button onclick="closeQuickMap()" class="bg-black/50 text-white w-10 h-10 rounded-full text-2xl font-light backdrop-blur-md">&times;</button>
        </div>
        <div id="quickMapCanvas"></div>
        <div class="absolute bottom-6 left-0 w-full px-6 pointer-events-none">
            <div class="bg-white p-4 rounded-2xl shadow-2xl pointer-events-auto border border-orange-100">
                <h3 id="modalClinicName" class="font-bold text-lg text-gray-800">è¨ºæ‰€åç¨±</h3>
                <p id="modalClinicAddr" class="text-xs text-gray-500 mt-1">åœ°å€è¼‰å…¥ä¸­...</p>
                <div class="flex gap-2 mt-4">
                    <a id="modalCallBtn" href="#" class="flex-1 bg-orange-500 text-white text-center py-3 rounded-xl font-bold text-sm">å³åˆ»è‡´é›»</a>
                </div>
            </div>
        </div>
    </div>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md rounded-full px-10 py-4 flex gap-12 z-[2000] shadow-xl border border-gray-100">
        <button onclick="goHome()" class="text-orange-500 flex flex-col items-center">
            <span class="text-xl">ğŸ“‹</span><span class="text-[9px] font-bold">åå–®</span>
        </button>
        <button onclick="alert('å…¨æ¸¯å¤§åœ°åœ–åŠŸèƒ½æ­£åœ¨æ•´åˆä¸­')" class="text-gray-400 flex flex-col items-center">
            <span class="text-xl">ğŸ“</span><span class="text-[9px] font-bold">å¤§åœ°åœ–</span>
        </button>
    </nav>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const clinics = [
            { name: "Pets Central åŒ—è§’", area: "æ¸¯å³¶", address: "åŒ—è§’æ¸£è¯é“70è™Ÿ", phone: "28118907", is24hr: true, hasER: true, rating: 4.8, lat: 22.2908, lng: 114.2005 },
            { name: "SPCA ç£ä»”ç¸½éƒ¨", area: "æ¸¯å³¶", address: "ç£ä»”é‹ç››è¡—5è™Ÿ", phone: "28020501", is24hr: true, hasER: true, rating: 4.6, lat: 22.2825, lng: 114.1812 },
            { name: "åŸå¤§å‹•ç‰©é†«ç™‚ä¸­å¿ƒ", area: "ä¹é¾", address: "æ·±æ°´åŸ—è”æè§’é“339è™Ÿ", phone: "36503000", is24hr: true, hasER: true, rating: 4.7, lat: 22.3364, lng: 114.1485 },
            { name: "NPV éç‰Ÿåˆ©ç¸é†«è¨ºæ‰€", area: "ä¹é¾", address: "å¤ªå­åŸºéš†è¡—22è™Ÿ", phone: "23932070", is24hr: true, hasER: false, rating: 4.2, lat: 22.3255, lng: 114.1678 }
        ];

        let filters = { is24hr: false, hasER: false };
        let quickMap = null;
        let quickMarker = null;

        function renderClinics(data) {
            const container = document.getElementById('clinicContainer');
            document.getElementById('resultsCount').innerText = `æ‰¾åˆ° ${data.length} é–“è¨ºæ‰€`;
            
            container.innerHTML = data.map(c => `
                <div class="clinic-card bg-white p-5 rounded-[26px] shadow-sm flex flex-col gap-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <h3 class="font-bold text-gray-900 text-md">${c.name}</h3>
                                ${c.is24hr ? '<span class="bg-red-500 text-white text-[8px] px-1.5 py-0.5 rounded font-bold">24H</span>' : ''}
                            </div>
                            <p class="text-[11px] text-gray-400 mt-1 font-medium italic">${c.address}</p>
                        </div>
                        <div class="text-orange-500 font-bold text-sm">â˜… ${c.rating}</div>
                    </div>

                    <div class="flex gap-2">
                        <a href="tel:${c.phone}" class="flex-[2] bg-orange-500 text-white text-center py-3.5 rounded-2xl font-bold text-xs shadow-lg shadow-orange-100">é›»è©±æŸ¥è©¢</a>
                        <button onclick="openQuickMap('${c.name}', '${c.address}', '${c.phone}', ${c.lat}, ${c.lng})" 
                            class="flex-1 bg-white text-gray-600 py-3.5 rounded-2xl font-bold text-xs border border-gray-200">åœ°åœ–</button>
                    </div>
                </div>
            `).join('');
        }

        // --- åŠŸèƒ½å‡½æ•¸ ---
        function goHome() {
            document.getElementById('mainSearch').value = '';
            document.getElementById('areaFilter').value = '';
            filters = { is24hr: false, hasER: false };
            document.querySelectorAll('.filter-chip, button').forEach(el => el.classList.remove('filter-active'));
            filterClinics();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function filterClinics() {
            const q = document.getElementById('mainSearch').value.toLowerCase();
            const area = document.getElementById('areaFilter').value;
            const filtered = clinics.filter(c => {
                return (c.name.toLowerCase().includes(q) || c.address.includes(q)) &&
                       (area === "" || c.area === area) &&
                       (!filters.is24hr || c.is24hr) &&
                       (!filters.hasER || c.hasER);
            });
            renderClinics(filtered);
        }

        function toggleFilter(type) {
            filters[type === '24hr' ? 'is24hr' : 'hasER'] = !filters[type === '24hr' ? 'is24hr' : 'hasER'];
            document.getElementById(type === '24hr' ? 'btn24hr' : 'btnER').classList.toggle('filter-active');
            filterClinics();
        }

        // --- Quick Map é‚è¼¯ ---
        function openQuickMap(name, addr, phone, lat, lng) {
            document.getElementById('quickMapModal').style.display = 'block';
            document.getElementById('modalOverlay').classList.remove('hidden');
            document.getElementById('modalClinicName').innerText = name;
            document.getElementById('modalClinicAddr').innerText = addr;
            document.getElementById('modalCallBtn').href = "tel:" + phone;

            if (!quickMap) {
                quickMap = L.map('quickMapCanvas', { zoomControl: false });
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(quickMap);
            }
            
            quickMap.setView([lat, lng], 16);
            if (quickMarker) quickMap.removeLayer(quickMarker);
            quickMarker = L.marker([lat, lng], {
                icon: L.divIcon({ html: 'ğŸ“', className: 'text-3xl' })
            }).addTo(quickMap);

            setTimeout(() => quickMap.invalidateSize(), 300);
        }

        function closeQuickMap() {
            document.getElementById('quickMapModal').style.display = 'none';
            document.getElementById('modalOverlay').classList.add('hidden');
        }

        renderClinics(clinics);
        function toggleSidebar() { alert('é¸å–®é–‹ç™¼ä¸­...'); }
    </script>
</body>
</html>
