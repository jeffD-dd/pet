<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PetPetDoc | å…¨æ¸¯ç¸é†«åå–®</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans HK', sans-serif; background-color: #F8FAFC; }
        .clinic-card { transition: all 0.2s; border: 1px solid #e2e8f0; cursor: pointer; }
        .clinic-card:hover { border-color: #f97316; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.1); }
        .filter-active { background-color: #f97316 !important; color: white !important; }
        
        /* æ‰‹æ©Ÿç‰ˆéš±è—åœ°åœ–ï¼Œé›»è…¦ç‰ˆé¡¯ç¤º */
        #desktopMap { height: calc(100vh - 80px); width: 100%; sticky: top 80px; }
        
        /* æ‰‹æ©Ÿ Quick Map Modal (åªå–ºæ‰‹æ©Ÿé¡¯ç¤º) */
        #quickMapModal {
            display: none;
            position: fixed;
            bottom: 0; left: 0; width: 100%; height: 70vh;
            background: white; z-index: 3000;
            border-radius: 30px 30px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="overflow-hidden md:overflow-auto">

    <header class="sticky top-0 z-[1000] bg-white border-b border-gray-100 shadow-sm">
        <div class="max-w-[1440px] mx-auto p-4 flex items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <button class="text-xl text-gray-400 md:hidden">â˜°</button>
                <div onclick="goHome()" class="flex items-center gap-1 cursor-pointer">
                    <span class="text-2xl">ğŸ¾</span>
                    <span class="text-xl font-bold text-orange-500">PetPetDoc</span>
                </div>
            </div>
            
            <div class="relative flex-1 max-w-xl">
                <input type="text" id="mainSearch" onkeyup="filterClinics()" placeholder="æœå°‹è¨ºæ‰€ã€åœ°å€..." 
                    class="w-full bg-gray-100 p-2.5 pl-10 rounded-xl text-sm outline-none focus:ring-2 ring-orange-100">
                <span class="absolute left-3 top-2.5 text-gray-400">ğŸ”</span>
            </div>

            <div class="hidden md:flex gap-2">
                <button id="d-btn24hr" onclick="toggleFilter('24hr')" class="px-4 py-2 rounded-xl text-xs font-bold bg-gray-100 text-gray-600">ğŸ•’ 24å°æ™‚</button>
                <button id="d-btnER" onclick="toggleFilter('ER')" class="px-4 py-2 rounded-xl text-xs font-bold bg-gray-100 text-gray-600">ğŸš¨ æ€¥ç—‡</button>
            </div>
        </div>
    </header>

    <div class="flex flex-col md:flex-row max-w-[1440px] mx-auto h-[calc(100vh-80px)]">
        
        <aside class="w-full md:w-[450px] lg:w-[500px] h-full overflow-y-auto p-4 no-scrollbar">
            <div class="md:hidden mb-4 flex gap-2 overflow-x-auto no-scrollbar pb-2">
                <select id="areaFilter" onchange="filterClinics()" class="bg-white border px-3 py-2 rounded-xl text-xs font-bold">
                    <option value="">å…¨æ¸¯åœ°å€</option>
                    <option value="æ¸¯å³¶">æ¸¯å³¶å€</option>
                    <option value="ä¹é¾">ä¹é¾å€</option>
                </select>
                <button id="m-btn24hr" onclick="toggleFilter('24hr')" class="bg-white border px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap">24H</button>
                <button id="m-btnER" onclick="toggleFilter('ER')" class="bg-white border px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap">æ€¥ç—‡</button>
            </div>

            <div id="resultsCount" class="text-[10px] text-gray-400 font-bold mb-4 uppercase">åå–®æ›´æ–°ä¸­...</div>
            
            <div id="clinicContainer" class="space-y-4 pb-20 md:pb-4">
                </div>
        </aside>

        <main class="hidden md:block flex-1 bg-gray-200 relative">
            <div id="desktopMap"></div>
        </main>
    </div>

    <div id="modalOverlay" class="fixed inset-0 bg-black/40 hidden z-[2999]" onclick="closeQuickMap()"></div>
    <div id="quickMapModal" class="md:hidden">
        <div class="absolute top-4 right-4 z-[3001]">
            <button onclick="closeQuickMap()" class="bg-black/50 text-white w-10 h-10 rounded-full text-2xl">&times;</button>
        </div>
        <div id="quickMapCanvas" style="height: 100%; width: 100%;"></div>
    </div>

    <nav class="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-white shadow-2xl rounded-full px-10 py-4 flex gap-12 z-[2000] border border-gray-100">
        <button onclick="goHome()" class="text-orange-500 flex flex-col items-center">
            <span class="text-xl">ğŸ“‹</span><span class="text-[9px] font-bold">åå–®</span>
        </button>
        <button onclick="alert('æ‰‹æ©Ÿå¤§åœ°åœ–é–‹ç™¼ä¸­')" class="text-gray-400 flex flex-col items-center">
            <span class="text-xl">ğŸ“</span><span class="text-[9px] font-bold">åœ°åœ–</span>
        </button>
    </nav>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const clinics = [
            { name: "Pets Central åŒ—è§’", area: "æ¸¯å³¶", address: "åŒ—è§’æ¸£è¯é“70è™Ÿ", phone: "2811 8907", is24hr: true, hasER: true, rating: 4.8, lat: 22.2908, lng: 114.2005 },
            { name: "SPCA ç£ä»”ç¸½éƒ¨", area: "æ¸¯å³¶", address: "ç£ä»”é‹ç››è¡—5è™Ÿ", phone: "2802 0501", is24hr: true, hasER: true, rating: 4.6, lat: 22.2825, lng: 114.1812 },
            { name: "åŸå¤§å‹•ç‰©é†«ç™‚ä¸­å¿ƒ", area: "ä¹é¾", address: "æ·±æ°´åŸ—è”æè§’é“339è™Ÿ", phone: "3650 3000", is24hr: true, hasER: true, rating: 4.7, lat: 22.3364, lng: 114.1485 },
            { name: "NPV éç‰Ÿåˆ©ç¸é†«è¨ºæ‰€", area: "ä¹é¾", address: "å¤ªå­åŸºéš†è¡—22è™Ÿ", phone: "2393 2070", is24hr: true, hasER: false, rating: 4.2, lat: 22.3255, lng: 114.1678 }
        ];

        let filters = { is24hr: false, hasER: false };
        let dMap = null; // é›»è…¦åœ°åœ–
        let qMap = null; // æ‰‹æ©Ÿåœ°åœ–
        let dMarkers = [];

        function renderClinics(data) {
            const container = document.getElementById('clinicContainer');
            document.getElementById('resultsCount').innerText = `å…± ${data.length} é–“è¨ºæ‰€`;
            
            container.innerHTML = data.map(c => `
                <div class="clinic-card bg-white p-5 rounded-[24px] shadow-sm flex flex-col gap-3" onclick="focusClinic(${c.lat}, ${c.lng}, '${c.name}')">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <h3 class="font-bold text-gray-900 text-md">${c.name}</h3>
                                ${c.is24hr ? '<span class="bg-red-500 text-white text-[8px] px-1.5 py-0.5 rounded font-bold">24H</span>' : ''}
                            </div>
                            <p class="text-[11px] text-gray-400 mt-1">${c.address}</p>
                            <a href="tel:${c.phone}" class="text-orange-500 font-bold text-sm block mt-2">${c.phone}</a>
                        </div>
                        <div class="text-orange-500 font-bold text-xs bg-orange-50 px-2 py-1 rounded-lg">â˜… ${c.rating}</div>
                    </div>
                    <button onclick="openQuickMap('${c.name}', ${c.lat}, ${c.lng})" class="md:hidden w-full bg-gray-50 py-3 rounded-xl text-xs font-bold border border-gray-100 mt-2">ğŸ“ æŸ¥çœ‹ä½ç½®</button>
                </div>
            `).join('');
        }

        // --- é›»è…¦ç‰ˆåœ°åœ–é‚è¼¯ ---
        function initDesktopMap() {
            if (window.innerWidth >= 768) {
                dMap = L.map('desktopMap', { zoomControl: false }).setView([22.3193, 114.1694], 12);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(dMap);
                updateMarkers(clinics);
            }
        }

        function updateMarkers(data) {
            if (!dMap) return;
            dMarkers.forEach(m => dMap.removeLayer(m));
            dMarkers = data.map(c => {
                let m = L.marker([c.lat, c.lng]).addTo(dMap).bindPopup(`<b>${c.name}</b>`);
                return m;
            });
        }

        function focusClinic(lat, lng, name) {
            if (window.innerWidth >= 768 && dMap) {
                dMap.setView([lat, lng], 16);
            }
        }

        // --- ç¯©é¸åŠŸèƒ½ ---
        function filterClinics() {
            const q = document.getElementById('mainSearch').value.toLowerCase();
            const filtered = clinics.filter(c => {
                return c.name.toLowerCase().includes(q) &&
                       (!filters.is24hr || c.is24hr) &&
                       (!filters.hasER || c.hasER);
            });
            renderClinics(filtered);
            updateMarkers(filtered);
        }

        function toggleFilter(type) {
            filters[type === '24hr' ? 'is24hr' : 'hasER'] = !filters[type === '24hr' ? 'is24hr' : 'hasER'];
            // åŒæ™‚æ›´æ–°æ‰‹æ©ŸåŒé›»è…¦ç‰ˆå˜…åˆ¶è‰²
            ['d-btn', 'm-btn'].forEach(p => {
                const btn = document.getElementById(`${p}${type === '24hr' ? '24hr' : 'ER'}`);
                if(btn) btn.classList.toggle('filter-active');
            });
            filterClinics();
        }

        // --- æ‰‹æ©Ÿ Quick Map ---
        function openQuickMap(name, lat, lng) {
            document.getElementById('quickMapModal').style.display = 'block';
            document.getElementById('modalOverlay').classList.remove('hidden');
            if (!qMap) {
                qMap = L.map('quickMapCanvas', { zoomControl: false });
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(qMap);
            }
            qMap.setView([lat, lng], 16);
            L.marker([lat, lng]).addTo(qMap);
            setTimeout(() => qMap.invalidateSize(), 300);
        }

        function closeQuickMap() {
            document.getElementById('quickMapModal').style.display = 'none';
            document.getElementById('modalOverlay').classList.add('hidden');
        }

        window.onload = () => { renderClinics(clinics); initDesktopMap(); };
        function goHome() { location.reload(); }
    </script>
</body>
</html>
